{"createdAt":"2025-04-07T01:03:32.488Z","updatedAt":"2025-06-23T03:29:49.056Z","id":"NLWJceyWThekkIhB","name":"EDP Stop/Start Stage","active":true,"isArchived":false,"nodes":[{"parameters":{"authentication":"privateKey","command":"#!/bin/bash\ncluster_name=\"stage\"\nexport AWS_PROFILE=STAGE\naws eks describe-nodegroup --cluster-name $cluster_name --nodegroup-name app-nodes-spot\n\naws eks describe-nodegroup --cluster-name $cluster_name --nodegroup-name db-stage-spot\n\n\naws eks update-nodegroup-config \\\n    --cluster-name $cluster_name \\\n    --nodegroup-name app-nodes-spot \\\n    --scaling-config minSize=0,maxSize=1,desiredSize=0\n\naws eks update-nodegroup-config \\\n    --cluster-name $cluster_name \\\n    --nodegroup-name db-stage-spot \\\n    --scaling-config minSize=0,maxSize=1,desiredSize=0\n\nPROFILE=CXM_BATMAN\necs_clusters=$(aws ecs list-clusters --profile $PROFILE --output json | jq -r '.clusterArns[]')\n                for cluster in $ecs_clusters; do\n                    ecs_services=$(aws ecs list-services --cluster $cluster --profile $PROFILE --output json | jq -r '.serviceArns[]')\n                    for service in $ecs_services; do\n                        aws ecs update-service --cluster $cluster --service $service --desired-count 0 --profile $PROFILE\n                    done\n                done\naws events disable-rule --name cxm-distribution --profile $PROFILE\n"},"type":"n8n-nodes-base.ssh","typeVersion":1,"position":[-140,-120],"id":"85dd92f6-a50a-4e06-b503-3b60714e23bf","name":"Stop","credentials":{"sshPrivateKey":{"id":"YoUKXALPqzvnzlxj","name":"EDP-Shell"}}},{"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 20 * * *"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-340,-120],"id":"7e246276-0a34-4703-b7f6-ac5aefd827c8","name":"Schedule Stop"},{"parameters":{"authentication":"privateKey","command":"#!/bin/bash\ncluster_name=\"stage\"\nexport AWS_PROFILE=STAGE\naws eks describe-nodegroup --cluster-name $cluster_name --nodegroup-name app-nodes-spot\n\naws eks describe-nodegroup --cluster-name $cluster_name --nodegroup-name db-stage-spot\n\n\naws eks update-nodegroup-config \\\n    --cluster-name $cluster_name \\\n    --nodegroup-name app-nodes-spot \\\n    --scaling-config minSize=3,maxSize=3,desiredSize=3\n\naws eks update-nodegroup-config \\\n    --cluster-name $cluster_name \\\n    --nodegroup-name db-stage-spot \\\n    --scaling-config minSize=2,maxSize=2,desiredSize=2\n\nPROFILE=CXM_BATMAN\necs_clusters=$(aws ecs list-clusters --profile $PROFILE --output json | jq -r '.clusterArns[]')\nfor cluster in $ecs_clusters; do\n    ecs_services=$(aws ecs list-services --cluster $cluster --profile $PROFILE --output json | jq -r '.serviceArns[]')\n    for service in $ecs_services; do\n        aws ecs update-service --cluster $cluster --service $service --desired-count 1 --profile $PROFILE\n    done\ndone\naws events enable-rule --name cxm-distribution --profile $PROFILE\n"},"type":"n8n-nodes-base.ssh","typeVersion":1,"position":[-140,60],"id":"0066bfe6-0d00-420f-a7c4-0737e974da26","name":"Start","credentials":{"sshPrivateKey":{"id":"YoUKXALPqzvnzlxj","name":"EDP-Shell"}}},{"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 8 * * 1-5"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-340,60],"id":"185224bc-570f-4a9b-ae80-b77ed2f8ebdb","name":"Schedule Start"}],"connections":{"Schedule Stop":{"main":[[{"node":"Stop","type":"main","index":0}]]},"Schedule Start":{"main":[[{"node":"Start","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Schedule Stop":{"recurrenceRules":[]},"node:Schedule Start":{"recurrenceRules":[]}},"meta":null,"pinData":{},"versionId":"93676734-e603-4c8e-9555-f11ebeb892c0","triggerCount":2,"tags":[{"createdAt":"2024-10-27T19:35:04.963Z","updatedAt":"2024-10-27T19:35:04.963Z","id":"XGnSXuSd9l0ZeIF7","name":"edp"}]}